<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INFINITY ORBIT V2 — Mission Preparedness</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Rajdhani:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --nolan-gold: #c9a227; --nolan-orange: #d4740c;
            --orbit-25: #4ecdc4; --orbit-50: #ffe66d;
            --orbit-75: #ff6b6b; --orbit-infinity: #a855f7;
            --deep-space: #000000; --panel-bg: rgba(10, 22, 40, 0.9);
            --neg-red: #ff4757; --pos-green: #2ed573;
        }

        body { min-height: 100vh; background: var(--deep-space); font-family: 'Rajdhani', sans-serif; color: #fff; overflow-x: hidden; }
        .letterbox-top, .letterbox-bottom { position: fixed; left: 0; width: 100%; height: 40px; background: #000; z-index: 1000; pointer-events: none; }
        .letterbox-top { top: 0; } .letterbox-bottom { bottom: 0; }

        .space-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(ellipse at center, #050510 0%, #000000 100%); pointer-events: none; z-index: -1; }
        
        .app-container { position: relative; z-index: 10; padding: 60px 20px; max-width: 1400px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 30px; }
        .title { font-family: 'Bebas Neue', sans-serif; font-size: 3rem; letter-spacing: 12px; background: linear-gradient(135deg, #fff, var(--nolan-gold)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        .dashboard { display: grid; grid-template-columns: 380px 1fr 350px; gap: 20px; }
        @media (max-width: 1100px) { .dashboard { grid-template-columns: 1fr; } }

        .panel { background: var(--panel-bg); border: 1px solid rgba(201, 162, 39, 0.2); border-radius: 4px; display: flex; flex-direction: column; }
        .panel-header { padding: 12px; background: rgba(201, 162, 39, 0.1); border-bottom: 1px solid rgba(201, 162, 39, 0.2); font-family: 'Orbitron'; font-size: 0.6rem; color: var(--nolan-gold); letter-spacing: 2px; }

        /* Form Styling */
        .panel-body { padding: 20px; }
        .tier-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-bottom: 15px; }
        .tier-btn { padding: 10px; background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.1); color: #fff; cursor: pointer; transition: 0.3s; text-align: center; }
        .tier-btn.active { border-color: var(--nolan-gold); background: rgba(201, 162, 39, 0.1); }
        .form-group { margin-bottom: 12px; }
        .form-label { font-size: 0.6rem; color: var(--nolan-gold); display: block; margin-bottom: 5px; font-family: 'Orbitron'; }
        .form-input { width: 100%; padding: 10px; background: #000; border: 1px solid rgba(255,255,255,0.1); color: #fff; font-family: 'Rajdhani'; }

        /* Process Type Toggles */
        .process-toggle { display: flex; gap: 5px; margin-bottom: 10px; }
        .type-btn { flex: 1; padding: 5px; font-size: 0.6rem; border: 1px solid rgba(255,255,255,0.1); background: transparent; color: #fff; cursor: pointer; font-family: 'Orbitron'; }
        .type-btn.pos.active { border-color: var(--pos-green); color: var(--pos-green); }
        .type-btn.neg.active { border-color: var(--neg-red); color: var(--neg-red); }

        /* Mission Deck */
        .deck-section { margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px; }
        .deck-list { display: flex; flex-direction: column; gap: 8px; max-height: 200px; overflow-y: auto; }
        .deck-item { padding: 10px; background: rgba(255,255,255,0.05); border-left: 3px solid var(--nolan-gold); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: 0.2s; }
        .deck-item:hover { background: rgba(255,255,255,0.1); transform: translateX(5px); }
        .deck-item-name { font-weight: 600; font-size: 0.9rem; }
        .deck-item-meta { font-family: 'Orbitron'; font-size: 0.5rem; opacity: 0.6; }

        /* Central Visuals */
        .orbit-visual { display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        .orbit-container { position: relative; width: 300px; height: 300px; border-radius: 50%; border: 1px dashed rgba(255,255,255,0.1); }
        .focus-core { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 60px; height: 60px; background: var(--nolan-gold); border-radius: 50%; box-shadow: 0 0 30px var(--nolan-gold); }
        
        /* History Fix */
        .history-list { padding: 10px; }
        .history-item { display: flex; align-items: center; gap: 10px; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .history-name { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; min-width: 0; font-size: 0.85rem; }
        .history-status { font-family: 'Orbitron'; font-size: 0.5rem; flex-shrink: 0; }
        .history-status.aborted { color: var(--orbit-75); }
        .history-status.escaped { color: var(--orbit-25); }

        /* Process Items */
        .process-item { display: flex; align-items: center; gap: 8px; padding: 8px; background: rgba(0,0,0,0.3); margin-bottom: 5px; font-size: 0.8rem; }
        .process-type-indicator { width: 4px; height: 20px; flex-shrink: 0; }
        .process-type-indicator.pos { background: var(--pos-green); }
        .process-type-indicator.neg { background: var(--neg-red); }

        .btn-launch { width: 100%; padding: 15px; background: var(--nolan-gold); border: none; font-family: 'Bebas Neue'; font-size: 1.2rem; cursor: pointer; margin-top: 10px; letter-spacing: 2px; }
        .btn-stage { width: 100%; padding: 10px; background: transparent; border: 1px solid var(--nolan-gold); color: var(--nolan-gold); font-family: 'Orbitron'; font-size: 0.6rem; cursor: pointer; margin-top: 5px; }
        
        .timer-display { font-family: 'Bebas Neue'; font-size: 5rem; color: var(--orbit-25); text-align: center; }
        .mission-active { display: none; padding: 20px; }
        .mission-active.show { display: block; }
    </style>
</head>
<body>
    <div class="letterbox-top"></div>
    <div class="letterbox-bottom"></div>
    <div class="space-bg"></div>

    <div class="app-container">
        <header>
            <h1 class="title">INFINITY ORBIT V2</h1>
        </header>

        <div class="dashboard">
            <div class="panel">
                <div class="panel-header">ORBIT PREPARATION</div>
                <div class="panel-body">
                    <div class="tier-grid">
                        <button class="tier-btn" onclick="selectTier(25)">T25</button>
                        <button class="tier-btn" onclick="selectTier(50)">T50</button>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Orbit Name</label>
                        <input type="text" id="orbitName" class="form-input" placeholder="e.g. Coding">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Objective</label>
                        <input type="text" id="orbitObjective" class="form-input" placeholder="Goal...">
                    </div>
                    
                    <div class="form-label">Process Rubric</div>
                    <div class="process-toggle">
                        <button class="type-btn pos active" id="typePos" onclick="setProcessType('pos')">POSITIVE (+)</button>
                        <button class="type-btn neg" id="typeNeg" onclick="setProcessType('neg')">NEGATIVE (-)</button>
                    </div>
                    <div style="display:flex; gap:5px; margin-bottom:15px;">
                        <input type="text" id="processInput" class="form-input" placeholder="Add step...">
                        <button class="tier-btn" onclick="addProcessItem()">+</button>
                    </div>
                    <div id="tempProcessList"></div>

                    <button class="btn-stage" onclick="stageOrbit()">STAGE FOR DECK</button>
                    
                    <div class="deck-section">
                        <div class="form-label">MISSION DECK (READY)</div>
                        <div class="deck-list" id="missionDeck"></div>
                    </div>
                </div>
            </div>

            <div class="orbit-visual">
                <div id="idleVisual">
                    <div class="orbit-container">
                        <div class="focus-core"></div>
                    </div>
                </div>

                <div class="mission-active" id="activeUI">
                    <div class="timer-display" id="timer">00:00</div>
                    <div id="activeMissionName" style="text-align:center; font-family:'Orbitron'; color:var(--nolan-gold); margin-bottom:20px;"></div>
                    <div id="activeProcessList"></div>
                    <button class="btn-launch" style="background:var(--orbit-75); margin-top:20px;" onclick="abortMission()">ABORT MISSION</button>
                    <button class="btn-launch" style="background:var(--orbit-25);" id="escapeBtn" onclick="escapeMission()">ESCAPE VELOCITY</button>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">FLIGHT DATA</div>
                <div class="panel-body">
                    <div class="form-label">RECENT ORBITS</div>
                    <div class="history-list" id="historyList"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const state = {
            deck: [],
            history: JSON.parse(localStorage.getItem('orbitHistory')) || [],
            currentProcessType: 'pos',
            tempProcesses: [],
            selectedTier: 25,
            activeOrbit: null,
            timer: null,
            timeLeft: 0
        };

        function selectTier(t) {
            state.selectedTier = t;
            document.querySelectorAll('.tier-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
        }

        function setProcessType(type) {
            state.currentProcessType = type;
            document.getElementById('typePos').classList.toggle('active', type === 'pos');
            document.getElementById('typeNeg').classList.toggle('active', type === 'neg');
        }

        function addProcessItem() {
            const val = document.getElementById('processInput').value;
            if(!val) return;
            state.tempProcesses.push({ text: val, type: state.currentProcessType, done: false });
            document.getElementById('processInput').value = '';
            renderTempProcesses();
        }

        function renderTempProcesses() {
            const cont = document.getElementById('tempProcessList');
            cont.innerHTML = state.tempProcesses.map(p => `
                <div class="process-item">
                    <div class="process-type-indicator ${p.type}"></div>
                    <span>${p.text}</span>
                </div>
            `).join('');
        }

        function stageOrbit() {
            const name = document.getElementById('orbitName').value;
            if(!name) return;
            
            const newOrbit = {
                id: Date.now(),
                name: name,
                objective: document.getElementById('orbitObjective').value,
                tier: state.selectedTier,
                processes: [...state.tempProcesses]
            };

            state.deck.push(newOrbit);
            state.tempProcesses = [];
            document.getElementById('orbitName').value = '';
            document.getElementById('orbitObjective').value = '';
            renderTempProcesses();
            renderDeck();
        }

        function renderDeck() {
            const cont = document.getElementById('missionDeck');
            cont.innerHTML = state.deck.map(o => `
                <div class="deck-item" onclick="launchFromDeck(${o.id})">
                    <div>
                        <div class="deck-item-name">${o.name}</div>
                        <div class="deck-item-meta">T${o.tier} • ${o.processes.length} STEPS</div>
                    </div>
                    <div style="color:var(--nolan-gold)">▶</div>
                </div>
            `).join('');
        }

        function launchFromDeck(id) {
            const orbit = state.deck.find(o => o.id === id);
            state.activeOrbit = orbit;
            state.deck = state.deck.filter(o => o.id !== id);
            renderDeck();
            startOrbit();
        }

        function startOrbit() {
            document.getElementById('idleVisual').style.display = 'none';
            document.getElementById('activeUI').classList.add('show');
            document.getElementById('activeMissionName').textContent = state.activeOrbit.name.toUpperCase();
            
            state.timeLeft = state.activeOrbit.tier * 60;
            updateTimerDisplay();
            renderActiveProcesses();

            state.timer = setInterval(() => {
                state.timeLeft--;
                updateTimerDisplay();
                if(state.timeLeft <= 0) clearInterval(state.timer);
            }, 1000);
        }

        function renderActiveProcesses() {
            const cont = document.getElementById('activeProcessList');
            cont.innerHTML = state.activeOrbit.processes.map((p, i) => `
                <div class="process-item" onclick="toggleProcess(${i})" style="cursor:pointer; opacity:${p.done?0.5:1}">
                    <div class="process-type-indicator ${p.type}"></div>
                    <span style="text-decoration:${p.done?'line-through':'none'}">
                        ${p.type==='neg'?'[AVOID] ':''}${p.text}
                    </span>
                    <span style="margin-left:auto">${p.done?'✓':''}</span>
                </div>
            `).join('');
        }

        function toggleProcess(index) {
            state.activeOrbit.processes[index].done = !state.activeOrbit.processes[index].done;
            renderActiveProcesses();
        }

        function updateTimerDisplay() {
            const m = Math.floor(state.timeLeft / 60);
            const s = state.timeLeft % 60;
            document.getElementById('timer').textContent = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
        }

        function abortMission() {
            if(!confirm("Abandon orbit? Streak will be lost.")) return;
            endMission('aborted');
        }

        function escapeMission() {
            endMission('escaped');
        }

        function endMission(status) {
            clearInterval(state.timer);
            const entry = {
                name: state.activeOrbit.name,
                status: status,
                tier: state.activeOrbit.tier,
                date: new Date().toLocaleTimeString()
            };
            state.history.unshift(entry);
            localStorage.setItem('orbitHistory', JSON.stringify(state.history.slice(0, 20)));
            
            state.activeOrbit = null;
            document.getElementById('idleVisual').style.display = 'block';
            document.getElementById('activeUI').classList.remove('show');
            renderHistory();
        }

        function renderHistory() {
            const cont = document.getElementById('historyList');
            cont.innerHTML = state.history.map(h => `
                <div class="history-item">
                    <div class="history-name">${h.name}</div>
                    <div class="history-status ${h.status}">${h.status.toUpperCase()}</div>
                </div>
            `).join('');
        }

        // Init
        renderHistory();
    </script>
</body>
</html>
