<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>INFINITY ORBIT v6 ‚Äî Neon Core</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Rajdhani:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* --- CORE --- */
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        :root {
            --gold: #c9a227;
            --orange: #d4740c;
            /* Neon Palette */
            --t25: #00f0ff; /* Cyan Neon */
            --t50: #ffd700; /* Gold Neon */
            --t75: #ff2a6d; /* Red Neon */
            --tinf: #d300c5; /* Purple Neon */
            
            --glass: rgba(8, 12, 18, 0.8);
            --border: rgba(255, 255, 255, 0.1);
        }
        body {
            height: 100vh; background: #020204; font-family: 'Rajdhani', sans-serif;
            overflow: hidden; color: #fff;
        }

        /* --- BACKGROUND --- */
        .grid-bg {
            position: fixed; inset: 0; z-index: 0;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.04) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.04) 1px, transparent 1px);
            background-size: 50px 50px;
            mask-image: radial-gradient(circle at center, black 30%, transparent 90%);
            -webkit-mask-image: radial-gradient(circle at center, black 30%, transparent 90%);
            pointer-events: none;
        }

        /* --- LAYOUT --- */
        .app { position: relative; z-index: 10; height: 100vh; display: grid; grid-template-rows: 60px 1fr; padding: 10px; gap: 10px; }
        
        .header { display: flex; align-items: center; justify-content: center; border-bottom: 1px solid var(--border); }
        .logo { 
            font-family: 'Bebas Neue'; font-size: 2.5rem; letter-spacing: 5px; 
            color: #fff; text-shadow: 0 0 15px rgba(255,255,255,0.5);
        }

        .workspace { display: grid; grid-template-columns: 320px 1fr 280px; gap: 15px; height: 100%; overflow: hidden; }
        @media (max-width: 1024px) { .workspace { grid-template-columns: 1fr; } .side-panel { display: none; } }

        /* --- PANELS --- */
        .panel {
            background: var(--glass); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border: 1px solid var(--border); border-radius: 4px; display: flex; flex-direction: column;
        }
        .panel.active { border-color: var(--gold); box-shadow: 0 0 25px rgba(201, 162, 39, 0.1); }

        .panel-head { padding: 15px; border-bottom: 1px solid var(--border); font-family: 'Orbitron'; font-size: 0.8rem; color: #888; letter-spacing: 2px; display: flex; align-items: center; gap: 8px; }
        .panel-dot { width: 6px; height: 6px; background: var(--gold); border-radius: 50%; box-shadow: 0 0 8px var(--gold); }
        .panel-body { padding: 15px; flex: 1; overflow-y: auto; }

        /* --- INPUTS --- */
        .input-group { margin-bottom: 15px; }
        .label { font-family: 'Orbitron'; font-size: 0.6rem; color: #666; margin-bottom: 6px; display: block; }
        .input {
            width: 100%; background: rgba(0,0,0,0.5); border: 1px solid #333; color: white;
            padding: 10px; font-family: 'Rajdhani'; font-size: 1.1rem; outline: none; border-radius: 4px; transition: 0.3s;
        }
        .input:focus { border-color: var(--gold); box-shadow: 0 0 15px rgba(201, 162, 39, 0.2); }
        
        /* Tiers */
        .tiers { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 20px; }
        .tier {
            padding: 10px 0; text-align: center; border: 1px solid #333; border-radius: 4px; cursor: pointer;
            background: rgba(0,0,0,0.3); transition: 0.3s;
        }
        .tier:hover { background: rgba(255,255,255,0.05); }
        .t-name { font-family: 'Bebas Neue'; font-size: 1.2rem; }
        
        /* Neon Active States */
        .tier.active { background: rgba(0,0,0,0.8); border-width: 1px; box-shadow: inset 0 0 15px rgba(0,0,0,0.5); }
        .t25 .t-name { color: var(--t25); } .tier.active.t25 { border-color: var(--t25); box-shadow: 0 0 15px var(--t25); }
        .t50 .t-name { color: var(--t50); } .tier.active.t50 { border-color: var(--t50); box-shadow: 0 0 15px var(--t50); }
        .t75 .t-name { color: var(--t75); } .tier.active.t75 { border-color: var(--t75); box-shadow: 0 0 15px var(--t75); }
        .tinf .t-name { color: var(--tinf); } .tier.active.tinf { border-color: var(--tinf); box-shadow: 0 0 15px var(--tinf); }

        .btn {
            width: 100%; padding: 14px; background: linear-gradient(90deg, var(--gold), var(--orange));
            border: none; border-radius: 4px; font-family: 'Bebas Neue'; font-size: 1.3rem; letter-spacing: 2px;
            color: black; cursor: pointer; margin-top: 15px; transition: 0.2s;
        }
        .btn:hover { filter: brightness(1.2); box-shadow: 0 0 20px rgba(201, 162, 39, 0.4); }

        /* --- ORBIT SPACE --- */
        .space-area { position: relative; width: 100%; height: 100%; overflow: hidden; }
        
        /* NEON ORBIT CARD */
        .orb-wrapper {
            position: absolute; width: 160px; height: 160px;
            cursor: grab; z-index: 10; touch-action: none;
        }
        .orb-wrapper:active { cursor: grabbing; z-index: 100 !important; }

        .orb-core {
            position: absolute; inset: 0; border-radius: 50%;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid var(--c); /* Dynamic Color */
            box-shadow: 0 0 15px var(--c), inset 0 0 30px rgba(0,0,0,0.9); /* Inner/Outer Glow */
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            backdrop-filter: blur(5px);
        }

        /* Rotating Particle Ring */
        .orb-particles {
            position: absolute; inset: -8px; border-radius: 50%;
            border: 2px dashed var(--c); /* Matches Tier */
            opacity: 0.6;
            filter: drop-shadow(0 0 5px var(--c)); /* Glowing Particles */
            animation: spin 30s linear infinite; pointer-events: none;
        }

        /* Inner Content */
        .orb-icon { 
            font-size: 3.5rem; color: #fff; margin-bottom: 5px; 
            text-shadow: 0 0 20px var(--c); /* Icon glows with tier color */
        }
        .orb-title { 
            font-family: 'Rajdhani'; font-weight: 700; font-size: 1.1rem; 
            max-width: 85%; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; 
            color: var(--c); text-shadow: 0 0 10px rgba(0,0,0,1);
        }
        .orb-time { font-family: 'Orbitron'; font-size: 0.6rem; opacity: 0.8; margin-top: 4px; color: #fff; }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* Controls */
        .orb-ctrls {
            position: absolute; top: -15px; right: -15px; display: flex; flex-direction: column; gap: 8px; z-index: 20;
        }
        .ctrl-btn {
            width: 32px; height: 32px; background: #000; border: 1px solid #333; border-radius: 50%;
            color: #666; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s;
        }
        .ctrl-btn:hover { transform: scale(1.15); border-color: #fff; color: #fff; }
        
        .c-launch { border-color: var(--c); color: var(--c); box-shadow: 0 0 10px var(--c); }
        .c-del { border-color: #ff2a6d; color: #ff2a6d; }
        .c-del:hover { background: rgba(255, 42, 109, 0.2); box-shadow: 0 0 15px #ff2a6d; }

        /* --- HUD --- */
        .hud-overlay {
            position: fixed; inset: 0; background: rgba(0, 0, 0, 0.9); backdrop-filter: blur(8px);
            z-index: 1000; display: none; align-items: center; justify-content: center; flex-direction: column;
        }
        .hud-overlay.active { display: flex; }

        .hud-timer { font-family: 'Bebas Neue'; font-size: 8rem; line-height: 1; color: #fff; text-shadow: 0 0 40px var(--active-c); }
        .hud-title { font-family: 'Orbitron'; letter-spacing: 5px; color: var(--active-c); margin-bottom: 20px; font-size: 1.5rem; text-shadow: 0 0 15px var(--active-c); }
        
        .hud-bar-box { width: 350px; margin-bottom: 30px; }
        .bar-track { width: 100%; height: 8px; background: #222; border-radius: 4px; overflow: hidden; border: 1px solid #444; }
        .bar-fill { height: 100%; background: var(--active-c); width: 100%; transition: 0.5s; box-shadow: 0 0 20px var(--active-c); }

        .hud-tasks { width: 350px; max-height: 300px; overflow-y: auto; background: rgba(255,255,255,0.03); padding: 20px; border-radius: 8px; border: 1px solid #333; }
        .task-row { display: flex; align-items: center; gap: 15px; padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); cursor: pointer; }
        .task-chk { width: 20px; height: 20px; border: 2px solid #555; display: flex; align-items: center; justify-content: center; font-size: 12px; color: black; border-radius: 4px; }
        .task-row.done .task-chk { background: var(--active-c); border-color: var(--active-c); box-shadow: 0 0 10px var(--active-c); }
        
        .hud-actions { display: flex; gap: 20px; margin-top: 30px; }
        .hud-btn { padding: 12px 40px; background: transparent; border: 1px solid #444; color: #fff; font-family: 'Orbitron'; cursor: pointer; font-size: 0.9rem; transition: 0.3s; }
        .hud-btn:hover { background: rgba(255,255,255,0.1); border-color: #fff; box-shadow: 0 0 15px rgba(255,255,255,0.2); }

        /* --- LOGS --- */
        .log-item { display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 0.9rem; }
        .log-score { font-family: 'Bebas Neue'; font-size: 1.4rem; text-shadow: 0 0 10px currentColor; }

        /* --- UTILS --- */
        .hidden { display: none; }
        .proc-tag { font-size: 0.6rem; padding: 2px 6px; border-radius: 2px; margin-right: 8px; color: black; font-weight: bold; }
        .tag-pos { background: var(--t25); box-shadow: 0 0 8px var(--t25); } .tag-neg { background: var(--t75); box-shadow: 0 0 8px var(--t75); }
    </style>
</head>
<body>

    <div class="grid-bg"></div>

    <div class="app">
        <header class="header">
            <div class="logo">INFINITY ORBIT</div>
        </header>

        <div class="workspace">
            <div class="panel side-panel" id="editorPanel">
                <div class="panel-head">
                    <div class="panel-dot"></div> <span id="editorTitle">MISSION COMMAND</span>
                </div>
                <div class="panel-body">
                    <div class="tiers">
                        <div class="tier t25" onclick="setTier('25', 25)"><div class="t-name">25</div></div>
                        <div class="tier t50" onclick="setTier('50', 50)"><div class="t-name">50</div></div>
                        <div class="tier t75" onclick="setTier('75', 75)"><div class="t-name">75</div></div>
                        <div class="tier tinf" onclick="setTier('inf', 90)"><div class="t-name">‚àû</div></div>
                    </div>
                    
                    <div class="input-group">
                        <label class="label">CODENAME</label>
                        <input type="text" class="input" id="inpName" placeholder="e.g. Deep Work">
                    </div>
                    <div class="input-group">
                        <label class="label">OBJECTIVE</label>
                        <input type="text" class="input" id="inpObj" placeholder="Goal...">
                    </div>
                    <div class="input-group">
                        <label class="label">DEADLINE</label>
                        <input type="datetime-local" class="input" id="inpDeadline" style="filter:invert(1);">
                    </div>

                    <div style="margin-top:20px; border-top:1px solid var(--border); padding-top:10px;">
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                            <label class="label">PROTOCOLS</label>
                            <button onclick="toggleProcMode()" style="background:none; border:1px solid var(--gold); color:var(--gold); font-size:10px; padding:4px 8px; cursor:pointer;">+ ADD</button>
                        </div>
                        <div id="procInputs" class="hidden" style="display:flex; gap:5px; margin-bottom:10px;">
                            <input id="newProcTxt" class="input" style="font-size:0.8rem;" placeholder="Task...">
                            <button onclick="addProc('pos')" style="background:var(--t25); border:none; width:30px; font-weight:bold;">+</button>
                            <button onclick="addProc('neg')" style="background:var(--t75); border:none; width:30px; font-weight:bold;">-</button>
                        </div>
                        <div id="editorProcs" style="max-height:150px; overflow-y:auto;"></div>
                    </div>

                    <button class="btn" id="btnSave" onclick="saveOrbit()">INITIALIZE ORBIT</button>
                    <button id="btnCancel" class="hidden" onclick="resetEditor()" style="width:100%; background:transparent; border:none; color:#666; margin-top:10px; cursor:pointer;">CANCEL UPDATE</button>
                </div>
            </div>

            <div class="panel space-area" id="spaceArea">
                <div style="position:absolute; bottom:15px; left:50%; transform:translateX(-50%); font-family:'Orbitron'; font-size:0.7rem; color:rgba(255,255,255,0.3); pointer-events:none;">
                    SYSTEM READY
                </div>
            </div>

            <div class="panel side-panel">
                <div class="panel-head">
                    <div class="panel-dot"></div> FLIGHT LOGS
                </div>
                <div class="panel-body" id="logList"></div>
                <button onclick="clearLogs()" style="background:transparent; border:none; color:#444; font-size:0.6rem; padding:10px; cursor:pointer;">PURGE DATA</button>
            </div>
        </div>
    </div>

    <div class="hud-overlay" id="hud">
        <div class="hud-title" id="hudName">MISSION ACTIVE</div>
        <div class="hud-timer" id="hudTimer">00:00</div>
        
        <div class="hud-bar-box">
            <div class="bar-track"><div class="bar-fill" id="hudBar"></div></div>
            <div style="display:flex; justify-content:space-between; font-family:'Orbitron'; font-size:0.7rem; margin-top:5px; color:#888;">
                <span>INTEGRITY</span>
                <span id="hudScore" style="color:#fff">100%</span>
            </div>
        </div>

        <div class="hud-tasks" id="hudList"></div>

        <div class="hud-actions">
            <button class="hud-btn" onclick="endMission('ABORTED')" style="border-color:var(--t75); color:var(--t75)">ABORT</button>
            <button class="hud-btn" onclick="endMission('COMPLETE')" style="border-color:var(--t25); color:var(--t25); box-shadow:0 0 15px rgba(0,240,255,0.2)">COMPLETE</button>
        </div>
    </div>

    <script>
        // --- CONFIG ---
        const colors = { '25': '#00f0ff', '50': '#ffd700', '75': '#ff2a6d', 'inf': '#d300c5' };
        const state = {
            dock: [],
            history: [],
            editor: { editing: false, id: null, tier: null, duration: 0, procs: [] },
            active: null,
            timerId: null
        };

        // --- DOM ---
        const $ = (id) => document.getElementById(id);

        // --- INIT ---
        window.onload = () => {
            loadData();
            renderSpace();
            renderLogs();
        };

        // --- EDITOR LOGIC ---
        function setTier(t, d) {
            state.editor.tier = t; 
            state.editor.duration = d;
            document.querySelectorAll('.tier').forEach(el => el.classList.remove('active'));
            document.querySelector(`.t${t}`).classList.add('active');
        }

        function toggleProcMode() { $('procInputs').classList.toggle('hidden'); $('newProcTxt').focus(); }

        function addProc(type) {
            const txt = $('newProcTxt').value.trim();
            if(!txt) return;
            state.editor.procs.push({ text: txt, type: type });
            $('newProcTxt').value = '';
            renderEditorProcs();
        }

        function renderEditorProcs() {
            $('editorProcs').innerHTML = state.editor.procs.map((p, i) => `
                <div style="display:flex; justify-content:space-between; padding:8px; border-bottom:1px solid rgba(255,255,255,0.05); font-size:0.9rem;">
                    <div><span class="proc-tag ${p.type === 'pos' ? 'tag-pos' : 'tag-neg'}">${p.type === 'pos' ? '+' : '-'}</span> ${p.text}</div>
                    <div style="cursor:pointer; color:#666;" onclick="delProc(${i})">√ó</div>
                </div>
            `).join('');
        }
        function delProc(i) { state.editor.procs.splice(i, 1); renderEditorProcs(); }

        function saveOrbit() {
            const name = $('inpName').value.trim();
            if (!name || !state.editor.tier) return alert("Name and Tier required");

            const data = {
                id: state.editor.editing ? state.editor.id : Date.now(),
                name: name,
                obj: $('inpObj').value || 'No Objective',
                deadline: $('inpDeadline').value,
                tier: state.editor.tier,
                duration: state.editor.duration,
                procs: [...state.editor.procs],
                x: state.editor.editing ? getOrbit(state.editor.id).x : 50,
                y: state.editor.editing ? getOrbit(state.editor.id).y : 50
            };

            if (state.editor.editing) {
                const idx = state.dock.findIndex(o => o.id === data.id);
                state.dock[idx] = data;
            } else {
                state.dock.push(data);
            }
            
            saveData();
            renderSpace();
            resetEditor();
        }

        function editOrbit(id) {
            const o = getOrbit(id);
            state.editor = { editing: true, id: id, tier: o.tier, duration: o.duration, procs: [...o.procs] };
            $('inpName').value = o.name;
            $('inpObj').value = o.obj;
            $('inpDeadline').value = o.deadline;
            setTier(o.tier, o.duration);
            renderEditorProcs();
            
            $('editorTitle').innerText = "EDITING SIGNAL";
            $('btnSave').innerText = "UPDATE ORBIT";
            $('editorPanel').classList.add('active');
            $('btnCancel').classList.remove('hidden');
        }

        function resetEditor() {
            state.editor = { editing: false, id: null, tier: null, duration: 0, procs: [] };
            $('inpName').value = ''; $('inpObj').value = ''; $('inpDeadline').value = ''; $('editorProcs').innerHTML = '';
            document.querySelectorAll('.tier').forEach(el => el.classList.remove('active'));
            $('editorTitle').innerText = "MISSION COMMAND";
            $('btnSave').innerText = "INITIALIZE ORBIT";
            $('editorPanel').classList.remove('active');
            $('btnCancel').classList.add('hidden');
        }

        // --- SPACE & DRAG ---
        function renderSpace() {
            $('spaceArea').innerHTML = state.dock.map(o => {
                const color = colors[o.tier];
                
                return `
                <div class="orb-wrapper" id="orb-${o.id}" style="left:${o.x}px; top:${o.y}px;" onmousedown="startDrag(event, ${o.id})" ontouchstart="startDrag(event, ${o.id})">
                    
                    <div class="orb-ctrls">
                        <div class="ctrl-btn c-launch" onmousedown="event.stopPropagation()" ontouchstart="event.stopPropagation()" onclick="launchMission(${o.id})">üöÄ</div>
                        <div class="ctrl-btn" onmousedown="event.stopPropagation()" ontouchstart="event.stopPropagation()" onclick="editOrbit(${o.id})">‚úé</div>
                        <div class="ctrl-btn c-del" onmousedown="event.stopPropagation()" ontouchstart="event.stopPropagation()" onclick="deleteOrbit(${o.id})">√ó</div>
                    </div>

                    <div class="orb-core" style="--c:${color}">
                        <div class="orb-particles" style="--c:${color}"></div>
                        <div class="orb-icon">‚óè</div>
                        <div class="orb-title" style="--c:${color}">${o.name}</div>
                        <div class="orb-time">${o.duration} MIN</div>
                    </div>
                </div>`;
            }).join('') + '<div style="position:absolute; bottom:15px; left:50%; transform:translateX(-50%); font-family:\'Orbitron\'; font-size:0.7rem; color:rgba(255,255,255,0.3); pointer-events:none;">SYSTEM READY</div>';
        }

        let drag = { active: false, id: null, offsetX: 0, offsetY: 0 };

        function startDrag(e, id) {
            if (e.target.closest('.orb-ctrls')) return;
            const el = $(`orb-${id}`);
            const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
            const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;

            drag = { active: true, id: id, offsetX: clientX - el.offsetLeft, offsetY: clientY - el.offsetTop };
            el.style.zIndex = 1000;
        }

        window.addEventListener('mousemove', doDrag);
        window.addEventListener('touchmove', doDrag, {passive: false});
        window.addEventListener('mouseup', endDrag);
        window.addEventListener('touchend', endDrag);

        function doDrag(e) {
            if (!drag.active) return;
            e.preventDefault();
            const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
            const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
            
            let x = clientX - drag.offsetX;
            let y = clientY - drag.offsetY;

            const rect = $('spaceArea').getBoundingClientRect();
            x = Math.max(0, Math.min(x, rect.width - 160));
            y = Math.max(0, Math.min(y, rect.height - 160));

            const el = $(`orb-${drag.id}`);
            el.style.left = x + 'px';
            el.style.top = y + 'px';
        }

        function endDrag() {
            if (!drag.active) return;
            const o = getOrbit(drag.id);
            const el = $(`orb-${drag.id}`);
            o.x = parseInt(el.style.left);
            o.y = parseInt(el.style.top);
            el.style.zIndex = 10;
            drag.active = false;
            saveData();
        }

        function deleteOrbit(id) {
            if(confirm("CONFIRM DELETION: This cannot be undone.")) {
                const idx = state.dock.findIndex(o => o.id === id);
                state.dock.splice(idx, 1);
                saveData();
                renderSpace();
            }
        }

        function getOrbit(id) { return state.dock.find(o => o.id === id); }

        // --- ACTIVE MISSION ---
        function launchMission(id) {
            const o = getOrbit(id);
            state.active = { data: o, timeLeft: o.duration * 60, checklist: o.procs.map(p => ({...p, done: false})) };
            
            $('hudName').innerText = o.name.toUpperCase();
            document.documentElement.style.setProperty('--active-c', colors[o.tier]);
            
            $('hud').classList.add('active');
            renderHUDList();
            updateIntegrity();
            startTimer();
        }

        function renderHUDList() {
            $('hudList').innerHTML = state.active.checklist.map((p, i) => `
                <div class="task-row ${p.done ? 'done' : ''} ${p.type}" onclick="toggleTask(${i})">
                    <div class="task-chk">${p.done ? '‚úì' : ''}</div>
                    <div style="flex:1; color:${p.type==='pos' ? '#fff' : '#ff9999'}">${p.text}</div>
                </div>
            `).join('');
        }

        function toggleTask(i) {
            state.active.checklist[i].done = !state.active.checklist[i].done;
            renderHUDList();
            updateIntegrity();
        }

        function updateIntegrity() {
            const list = state.active.checklist;
            const pos = list.filter(p => p.type === 'pos');
            const neg = list.filter(p => p.type === 'neg');
            
            let score = 100;
            if(pos.length > 0) {
                const valPerPos = 100 / pos.length;
                const missedPos = pos.filter(p => !p.done).length;
                score -= (missedPos * valPerPos);
            }
            const hitNeg = neg.filter(p => p.done).length;
            score -= (hitNeg * 15);
            
            score = Math.max(0, Math.round(score));
            state.active.score = score;
            
            $('hudScore').innerText = score + "%";
            $('hudBar').style.width = score + "%";
        }

        function startTimer() {
            clearInterval(state.timerId);
            updateTimerDisplay();
            state.timerId = setInterval(() => {
                state.active.timeLeft--;
                updateTimerDisplay();
                if(state.active.timeLeft <= 0) clearInterval(state.timerId);
            }, 1000);
        }

        function updateTimerDisplay() {
            const m = Math.floor(state.active.timeLeft / 60);
            const s = state.active.timeLeft % 60;
            $('hudTimer').innerText = `${m}:${s.toString().padStart(2,'0')}`;
        }

        function endMission(status) {
            clearInterval(state.timerId);
            state.history.unshift({
                name: state.active.data.name,
                score: state.active.score,
                status: status,
                time: new Date().toLocaleTimeString(),
                color: colors[state.active.data.tier]
            });
            $('hud').classList.remove('active');
            state.active = null;
            saveData();
            renderLogs();
        }

        // --- LOGS ---
        function renderLogs() {
            $('logList').innerHTML = state.history.map(h => `
                <div class="log-item">
                    <div>
                        <div style="color:${h.color}">${h.name}</div>
                        <div style="font-size:0.7rem; color:#666">${h.time}</div>
                    </div>
                    <div style="text-align:right">
                        <div class="log-score" style="color:${h.color}">${h.score}%</div>
                        <div style="font-size:0.6rem; color:#666">${h.status}</div>
                    </div>
                </div>
            `).join('');
        }

        // --- STORAGE ---
        function saveData() { localStorage.setItem('infOrbitV6', JSON.stringify({ dock: state.dock, history: state.history })); }
        function loadData() {
            const d = JSON.parse(localStorage.getItem('infOrbitV6'));
            if(d) { state.dock = d.dock || []; state.history = d.history || []; }
        }
        function clearLogs() { state.history = []; saveData(); renderLogs(); }
    </script>
</body>
</html>
